<launch>
  <arg name="init_x" default="0"/>
  <arg name="init_y" default="0"/>
  <arg name="init_z" default="1"/>
  <arg name="moving_obs_num" default="50"/>
  <arg name="moving_obs_mode" default="2"/> <!-- 0:const v, 1:const acc, 2:sin -->

  <node pkg="map_generator" name="random_forest" type="random_forest" output="screen">
    <param name="map/x_size" value="50"/>
    <param name="map/y_size" value="50"/>
    <param name="map/z_size" value="3"/>
    <param name="map/resolution" value="0.2"/>

    <!-- 静态障碍：100方盒 + 100圆柱 -->
    <param name="map/obs_num" value="100"/>
    <param name="map/circle_num" value="100"/>
    <param name="ObstacleShape/lower_hei" value="3.5"/>
    <param name="ObstacleShape/upper_hei" value="4.0"/>

    <!-- 动态障碍 -->
    <param name="map/moving_obs_num" value="$(arg moving_obs_num)"/>
    <param name="moving_obs/mode" value="$(arg moving_obs_mode)"/>
    <param name="ObstacleShape/radius_l" value="0.2"/>
    <param name="ObstacleShape/radius_h" value="1.0"/>

    <param name="pub_rate" value="50.0"/>
    <param name="min_distance" value="0.8"/>
  </node>

  <node pkg="local_sensing_node" type="pcl_render_node" name="pcl_render_node" output="screen">
    <rosparam command="load" file="$(find local_sensing_node)/params/camera.yaml"/>
    <param name="sensing_horizon" value="8.0"/>
    <param name="sensing_rate" value="30.0"/>
    <param name="estimation_rate" value="30.0"/>
    <param name="map/x_size" value="50"/>
    <param name="map/y_size" value="50"/>
    <param name="map/z_size" value="3"/>
    <remap from="~global_map" to="/map_generator/global_cloud"/>
    <remap from="~odometry" to="/sim/odom"/>
    <remap from="~pcl_render_node/cloud" to="/pcl_render_node/cloud"/>
  </node>

  <node pkg="so3_quadrotor_simulator" type="quadrotor_simulator_so3" name="quadrotor_simulator_so3" output="screen">
    <param name="rate/odom" value="100.0"/>
    <param name="simulator/init_state_x" value="$(arg init_x)"/>
    <param name="simulator/init_state_y" value="$(arg init_y)"/>
    <param name="simulator/init_state_z" value="$(arg init_z)"/>
    <remap from="~odom" to="/sim/odom"/>
    <remap from="~cmd" to="/so3_cmd"/>
    <remap from="~imu" to="/sim/imu"/>
  </node>

  <node pkg="nodelet" type="nodelet"
        args="standalone so3_control/SO3ControlNodelet"
        name="so3_control" required="true" output="screen">
    <param name="so3_control/init_state_x" value="$(arg init_x)"/>
    <param name="so3_control/init_state_y" value="$(arg init_y)"/>
    <param name="so3_control/init_state_z" value="$(arg init_z)"/>
    <remap from="~odom" to="/sim/odom"/>
    <remap from="~position_cmd" to="/position_cmd"/>
    <remap from="~motors" to="motors"/>
    <remap from="~corrections" to="corrections"/>
    <remap from="~so3_cmd" to="/so3_cmd"/>
    <remap from="~imu" to="/sim/imu"/>
    <rosparam file="$(find so3_control)/config/gains_hummingbird.yaml"/>
    <rosparam file="$(find so3_control)/config/corrections_hummingbird.yaml"/>
    <param name="mass" value="0.98"/>
    <param name="use_angle_corrections " value="false"/>
    <param name="use_external_yaw " value="false"/>
    <param name="gains/rot/z" value="1"/>
    <param name="gains/ang/z" value="0.3"/>
  </node>

  <node name="rviz" pkg="rviz" type="rviz" args="-d $(find so3_quadrotor_simulator)/config/rviz.rviz"/>
</launch>